@startuml B5_Shellshock_Game_Architecture

skinparam classAttributeIconSize 0
skinparam classFontSize 11
skinparam noteFontSize 10

title B5 Shellshock - OOP Architektur mit Vererbung, Interfaces und Polymorphie

legend right
  |= Symbol |= Bedeutung |
  | interface | Schnittstelle |
  | abstract | Abstrakte Klasse |
  | --|> | Vererbung |
  | ..|> | Implementierung |
  | --> | Assoziation |
  | o-- | Komposition |
endlegend

' === New Abstract Base Classes ===

interface IRenderable {
    + X : double
    + Y : double
    + IsActive : bool
}

interface ICollidable {
    + CollidesWith(proj) : bool
}

abstract class B5_Shellshock_GameEntity {
    # _x : double
    # _y : double
    # _isActive : bool
    --
    + {abstract} EntityType : string
    + X : double
    + Y : double
    + IsActive : bool
    + DistanceTo(other) : double
    + Deactivate() : void
}

abstract class B5_Shellshock_CollidableEntity {
    # {abstract} GetCollisionBounds() : Bounds
    + CollidesWith(proj) : bool
}

' === Terrain Generator Strategy Pattern ===

interface ITerrainGenerator {
    + Name : string
    + Generate(heightMap, width) : void
}

abstract class B5_Shellshock_TerrainGeneratorBase {
    + {abstract} Name : string
    # SmoothingPasses : int
    --
    + Generate(heightMap, width) : void
    # {abstract} GenerateRaw(heightMap, width) : void
    # ApplySmoothing(heightMap, width, passes) : void
    # ClampValues(heightMap, width) : void
}

class B5_Shellshock_FlatTerrainGenerator {
    + Name : string
    # GenerateRaw(heightMap, width) : void
}

class B5_Shellshock_HillTerrainGenerator {
    + Name : string
    # GenerateRaw(heightMap, width) : void
}

class B5_Shellshock_CurvyTerrainGenerator {
    + Name : string
    # GenerateRaw(heightMap, width) : void
}

class B5_Shellshock_ValleyTerrainGenerator {
    + Name : string
    # GenerateRaw(heightMap, width) : void
}

class B5_Shellshock_TerrainGeneratorFactory {
    + {static} Create(type) : ITerrainGenerator
    + {static} CreateRandom() : ITerrainGenerator
}

' === Core Game Classes ===

class B5_Shellshock_Field {
    - _tank1 : Tank
    - _tank2 : Tank
    - _terrain : Terrain
    - _projectile : Projectile
    - _healthPack : HealthPack
    - _wind : double
    - _movementsRemaining : int
    - _activeTankNumber : int
    - _gamePhase : GamePhase
    --
    + Tank1 : Tank
    + Tank2 : Tank
    + Terrain : Terrain
    + Projectile : Projectile
    + HealthPack : HealthPack
    + Wind : double
    + ProjectileInFlight : bool
    + Reset() : void
    + UpdateTankPositions() : void
    + GetTankByPlayer(num) : Tank
}

class B5_Shellshock_Rules {
    - _field : Field
    - _gamePhase : GamePhase
    - _gravity : double
    - _activeTankNumber : int
    - _pendingTurnSwitch : bool
    --
    + Name : string
    + CurrentField : IGameField
    + MovesPossible : bool
    + DoMove(move) : void
    + ClearField() : void
    + CheckIfPLayerWon() : int
    + StartedGameCall() : void
    + TickGameCall() : void
}

class B5_Shellshock_Tank {
    - _angle : double
    - _power : double
    - _health : int
    - _color : TankColor
    + {static} CollisionWidth : double
    + {static} CollisionHeight : double
    ==Invarianten==
    Angle in 0 bis 180
    Power in 0 bis 100
    Health >= 0
    --
    + Color : TankColor
    + IsAlive : bool
    + EntityType : string
    # GetCollisionBounds() : Bounds
    + TakeDamage(dmg) : void
    + Fire(player) : Projectile
    + MoveLeft(dist) : void
    + MoveRight(dist) : void
    + AdjustAngle(delta) : void
    + AdjustPower(delta) : void
}

class B5_Shellshock_Projectile {
    - _velocityX : double
    - _velocityY : double
    - _playerNumber : int
    - _powerNorm : double
    - {static} BaseGravityFactor : double
    - {static} LaunchSpeed : double
    --
    + VelocityX : double
    + VelocityY : double
    + PlayerNumber : int
    + EntityType : string
    + UpdatePosition(gravity, wind, dt) : void
}

class B5_Shellshock_Terrain {
    - _heightMap : double[]
    - _width : int
    - _terrainType : TerrainType
    - _generator : ITerrainGenerator
    --
    + HeightMap : double[]
    + Width : int
    + TerrainType : TerrainType
    + GetHeightAt(x) : double
    + IsCollision(x, y) : bool
    + DestroyTerrain(x, radius) : void
}

class B5_Shellshock_HealthPack {
    + {static} PackSize : double
    + {static} HealAmount : int
    --
    + EntityType : string
    # GetCollisionBounds() : Bounds
}

class B5_Shellshock_Painter {
    + Name : string
    + PaintGameField(canvas, field) : void
    + TickPaintGameField(canvas, field) : void
    - DrawTerrain() : void
    - DrawTank() : void
    - DrawProjectile() : void
    - DrawHealthPack() : void
    - DrawUI() : void
    - DrawOverlay() : void
}

class B5_Shellshock_HumanPlayer {
    - _playerNumber : int
    --
    + Name : string
    + PlayerNumber : int
    + SetPlayerNumber(num) : void
    + CanBeRuledBy(rules) : bool
    + Clone() : IGamePlayer
    + GetMove(selection, field) : IPlayMove
}

class B5_Shellshock_Move {
    - _playerNumber : int
    - _actionType : ActionType
    - _value : double
    --
    + PlayerNumber : int
    + ActionType : ActionType
    + Value : double
}

class B5_Shellshock_Point {
    + X : double
    + Y : double
}

' === Enums ===

enum B5_Shellshock_TankColor {
    Red
    Blue
}

enum B5_Shellshock_TerrainType {
    Flat
    Hill
    Valley
    Curvy
}

enum B5_Shellshock_ActionType {
    MoveLeft
    MoveRight
    IncreaseAngle
    DecreaseAngle
    IncreasePower
    DecreasePower
    Shoot
    StartGame
}

enum B5_Shellshock_GamePhase {
    Setup
    PlayerTurn
    ProjectileInFlight
    GameOver
}

' === Framework Interfaces ===

interface IGameField {
    + CanBePaintedBy(painter) : bool
}

interface IGameRules {
    + Name : string
    + CurrentField : IGameField
    + MovesPossible : bool
    + DoMove(move) : void
    + ClearField() : void
    + CheckIfPLayerWon() : int
}

interface IGameRules2 {
    + StartedGameCall() : void
    + TickGameCall() : void
}

interface IPaintGame2 {
    + Name : string
    + PaintGameField(canvas, field) : void
    + TickPaintGameField(canvas, field) : void
}

interface IHumanGamePlayer {
    + Name : string
    + PlayerNumber : int
    + SetPlayerNumber(num) : void
    + CanBeRuledBy(rules) : bool
    + Clone() : IGamePlayer
    + GetMove(selection, field) : IPlayMove
}

interface IPlayMove {
    + PlayerNumber : int
}

' ============================================
' === VERERBUNG (Inheritance) ===
' ============================================

B5_Shellshock_GameEntity ..|> IRenderable : implements
B5_Shellshock_CollidableEntity --|> B5_Shellshock_GameEntity : extends
B5_Shellshock_CollidableEntity ..|> ICollidable : implements

B5_Shellshock_Tank --|> B5_Shellshock_CollidableEntity : extends
B5_Shellshock_HealthPack --|> B5_Shellshock_CollidableEntity : extends
B5_Shellshock_Projectile --|> B5_Shellshock_GameEntity : extends

B5_Shellshock_TerrainGeneratorBase ..|> ITerrainGenerator : implements
B5_Shellshock_FlatTerrainGenerator --|> B5_Shellshock_TerrainGeneratorBase : extends
B5_Shellshock_HillTerrainGenerator --|> B5_Shellshock_TerrainGeneratorBase : extends
B5_Shellshock_CurvyTerrainGenerator --|> B5_Shellshock_TerrainGeneratorBase : extends
B5_Shellshock_ValleyTerrainGenerator --|> B5_Shellshock_TerrainGeneratorBase : extends

B5_Shellshock_Field ..|> IGameField : implements
B5_Shellshock_Rules ..|> IGameRules : implements
B5_Shellshock_Rules ..|> IGameRules2 : implements
B5_Shellshock_Painter ..|> IPaintGame2 : implements
B5_Shellshock_HumanPlayer ..|> IHumanGamePlayer : implements
B5_Shellshock_Move ..|> IPlayMove : implements

' ============================================
' === Composition and Association ===
' ============================================

B5_Shellshock_Field o-- "2" B5_Shellshock_Tank : contains
B5_Shellshock_Field o-- "1" B5_Shellshock_Terrain : contains
B5_Shellshock_Field o-- "0..1" B5_Shellshock_Projectile : contains
B5_Shellshock_Field o-- "0..1" B5_Shellshock_HealthPack : contains
B5_Shellshock_Field o-- "*" B5_Shellshock_Point : trajectories

B5_Shellshock_Rules o-- "1" B5_Shellshock_Field : manages

B5_Shellshock_Terrain o-- "1" ITerrainGenerator : strategy

B5_Shellshock_TerrainGeneratorFactory ..> ITerrainGenerator : creates

B5_Shellshock_Tank ..> B5_Shellshock_Projectile : fires

B5_Shellshock_Tank --> B5_Shellshock_TankColor : uses
B5_Shellshock_Terrain --> B5_Shellshock_TerrainType : uses
B5_Shellshock_Field --> B5_Shellshock_GamePhase : uses
B5_Shellshock_Move --> B5_Shellshock_ActionType : uses

B5_Shellshock_HumanPlayer ..> B5_Shellshock_Move : creates
B5_Shellshock_Painter ..> B5_Shellshock_Field : renders

' ============================================
' === Notes ===
' ============================================

note top of B5_Shellshock_GameEntity
  Abstrakte Oberklasse
  Gemeinsame Eigenschaften
  fuer alle Spielobjekte
end note

note top of B5_Shellshock_CollidableEntity
  Abstrakte Unterklasse
  Template Method Pattern
  GetCollisionBounds abstrakt
end note

note right of B5_Shellshock_Tank
  Konkrete Klasse
  Liskov Substitution
  Polymorphie
end note

note right of B5_Shellshock_TerrainGeneratorBase
  Strategy Pattern
  Template Method
end note

note bottom of B5_Shellshock_TerrainGeneratorFactory
  Factory Pattern
end note

@enduml
